trigger: none

resources:
  pipelines:
    - pipeline: ci-pipeline
      source: 'test-icinema-ci-pipeline'
      trigger:
        branches: ['main']

pool:
  vmImage: 'ubuntu-latest'

variables:
  - group: 'VG-TEST-ICINEMA'
  - name: azureSubscription
    value: 'SC-ARM-TEST-ICINEMA'
  - name: webAppName
    value: 'SERVIDOR-API-TEST'
  - name: resourceGroup
    value: 'test-icinema-academic'
  - name: imageRepository
    value: 'daldeoscoder/icinema-api'

stages:
  - stage: Deploy
    displayName: Deploy to Azure
    jobs:
      - deployment: Deploy
        environment: 'production'
        strategy:
          runOnce:
            deploy:
              steps:
                - task: AzureWebAppContainer@1
                  displayName: 'Deploy to Azure Web App'
                  inputs:
                    azureSubscription: $(azureSubscription)
                    appName: $(webAppName)
                    containers: '$(imageRepository):latest'
                    appSettings: |
                      -name DATABASE_URL -value "$(DATABASE_URL)"
                      -name WEBSITES_PORT -value "8000"